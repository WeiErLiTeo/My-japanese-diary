<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­å­¦ä¹ æ—¥è®° | æ¯æ—¥è®°å½•</title>
    <!-- åŠ è½½ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥è‡ªå®šä¹‰æ ·å¼å’ŒåŠ¨ç”» -->
    <style>
        /* ä½¿ç”¨æ›´é€‚åˆçš„å­—ä½“ï¼ŒInter æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ç°ä»£å­—ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans JP', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            /* æµç•…çš„èƒŒæ™¯æ¸å˜åŠ¨ç”» */
            background: linear-gradient(120deg, #1e0033, #3f004a, #1a0b38);
            background-size: 200% 200%;
            animation: gradientBG 20s ease infinite;
        }

        /* æ¸å˜åŠ¨ç”» */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* "ç»ç’ƒæ‹Ÿæ€" å¡ç‰‡æ ·å¼ */
        .glass-card {
            background: rgba(255, 255, 255, 0.05); /* åŠé€æ˜èƒŒæ™¯ */
            backdrop-filter: blur(12px); /* å…³é”®çš„æ¯›ç»ç’ƒæ•ˆæœ */
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* å¾®å¦™çš„è¾¹æ¡† */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* å¹³æ»‘è¿‡æ¸¡ */
        }
        .glass-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* æ ‡ç­¾æ æ¿€æ´»çŠ¶æ€ */
        .tab-button.active {
            color: white;
            background-color: #8B5CF6; /* ç´«è‰² */
        }

        /* è¡¨å•è¾“å…¥æ¡†æ ·å¼ */
        .form-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .form-input:focus {
            background: rgba(0, 0, 0, 0.3);
            border-color: #8B5CF6; /* ç„¦ç‚¹æ—¶ç´«è‰² */
            box-shadow: 0 0 0 2px #8B5CF6;
        }

        /* æ¸å˜æŒ‰é’® */
        .btn-gradient {
            background-image: linear-gradient(to right, #8B5CF6 0%, #EC4899 51%, #8B5CF6 100%);
            background-size: 200% auto;
            transition: 0.5s;
        }
        .btn-gradient:hover {
            background-position: right center; /* æ‚¬åœæ—¶æ¸å˜ç§»åŠ¨ */
        }
        .btn-gradient:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-image: none;
            background-color: #374151;
        }

        /* å¡ç‰‡æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .summary-card {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* ç®€å•çš„åŠ è½½åŠ¨ç”» */
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid #FFF;
            border-bottom-color: #8B5CF6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen p-4 md:p-8">

    <!-- 1. é¡µé¢æ ‡é¢˜ -->
    <header class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
            ğŸŒ¸ æˆ‘çš„æ—¥è¯­å­¦ä¹ æ—¥è®° ğŸŒ¸
        </h1>
        <p class="text-lg text-gray-300 mt-2">æ—¥ã€…ã®è¨˜éŒ²ã€æœªæ¥ã¸ã®æŠ•è³‡ã€‚</p>
    </header>

    <main class="max-w-4xl mx-auto">
        <!-- 2. æ ‡ç­¾é¡µåˆ‡æ¢ -->
        <div class="flex justify-center mb-8 bg-gray-800/50 rounded-lg p-1 max-w-sm mx-auto">
            <button id="tab-view" class="tab-button active w-1/2 py-2 px-4 rounded-md font-medium transition-all duration-300">æŸ¥çœ‹æ€»ç»“</button>
            <button id="tab-submit" class="tab-button w-1/2 py-2 px-4 rounded-md font-medium text-gray-400 transition-all duration-300">æäº¤æ–°æ€»ç»“</button>
        </div>

        <!-- 3. å†…å®¹åŒºåŸŸ -->
        <div>
            <!-- 3.1 æŸ¥çœ‹æ€»ç»“ (é»˜è®¤æ˜¾ç¤º) -->
            <section id="section-view">
                <div id="loading-spinner" class="text-center py-10">
                    <div class="loader mx-auto"></div>
                    <p class="mt-4 text-gray-400">æ­£åœ¨åŠ è½½æ—¥è®°...</p>
                </div>
                <div id="summary-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- æ€»ç»“å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
                    <!-- ç¤ºä¾‹å¡ç‰‡:
                    <div class="summary-card glass-card rounded-xl p-6 shadow-lg">
                        <p class="text-sm text-gray-400 mb-2">2023å¹´10æœˆ27æ—¥</p>
                        <p class="text-gray-100 whitespace-pre-line">ä»Šå¤©å­¦ä¹ äº† N2 è¯­æ³•ã€Œï½ã‚‚ã®ã ã‹ã‚‰ã€ï¼Œæ„Ÿè§‰å¾ˆæœ‰è¶£ã€‚</p>
                        <p class="mt-4 text-sm text-purple-300">è€å¸ˆé¼“åŠ±ï¼šç´ æ™´ã‚‰ã—ã„ï¼ãã®èª¿å­ã§é ‘å¼µã£ã¦ï¼</p>
                    </div>
                    -->
                </div>
                <p id="no-summaries" class="hidden text-center text-gray-400 py-10">è¿˜æ²¡æœ‰æ—¥è®°å“¦ï¼Œå¿«å»â€œæäº¤æ–°æ€»ç»“â€å§ï¼</p>
            </section>

            <!-- 3.2 æäº¤æ€»ç»“ (é»˜è®¤éšè—) -->
            <section id="section-submit" class="hidden">
                <div class="glass-card rounded-xl p-6 md:p-10 shadow-lg max-w-lg mx-auto">
                    <form id="summary-form">
                        <h2 class="text-2xl font-semibold text-center mb-6">ğŸ“ è®°å½•ä»Šæ—¥æ‰€å­¦</h2>
                        
                        <div class="mb-5">
                            <label for="admin-password" class="block text-sm font-medium text-gray-300 mb-2">ğŸ”‘ ç®¡ç†å‘˜å¯†ç </label>
                            <input type="password" id="admin-password" class="form-input w-full rounded-lg p-3 text-gray-100" placeholder="è¯·è¾“å…¥æ‚¨çš„å®‰å…¨å¯†ç " required>
                        </div>
                        
                        <div class="mb-6">
                            <label for="summary-content" class="block text-sm font-medium text-gray-300 mb-2">ğŸ“– å­¦ä¹ å†…å®¹</label>
                            <textarea id="summary-content" rows="6" class="form-input w-full rounded-lg p-3 text-gray-100" placeholder="ä¾‹å¦‚ï¼šä»Šå¤©å­¦ä¹ äº†... æŒæ¡äº†... é‡åˆ°çš„é—®é¢˜æ˜¯..." required></textarea>
                        </div>
                        
                        <button type="submit" id="submit-button" class="btn-gradient w-full text-white font-bold py-3 px-6 rounded-lg text-lg">
                            <span>æäº¤æ€»ç»“</span>
                        </button>
                        
                        <div id="form-message" class="mt-4 text-center"></div>
                    </form>
                </div>
            </section>
        </div>
    </main>

    <footer class="text-center text-gray-500 mt-16 pb-8">
        <p>&copy; 2025 ç”± Gemini å¼ºåŠ›é©±åŠ¨</p>
    </footer>

    <!-- 4. æ ¸å¿ƒ JavaScript é€»è¾‘ -->
    <script>
        // ç­‰å¾… DOM åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- è·å–å…ƒç´  ---
            const tabView = document.getElementById('tab-view');
            const tabSubmit = document.getElementById('tab-submit');
            const sectionView = document.getElementById('section-view');
            const sectionSubmit = document.getElementById('section-submit');
            
            const summaryForm = document.getElementById('summary-form');
            const submitButton = document.getElementById('submit-button');
            const formMessage = document.getElementById('form-message');
            const passwordInput = document.getElementById('admin-password');
            const contentInput = document.getElementById('summary-content');
            
            const summaryGrid = document.getElementById('summary-grid');
            const loadingSpinner = document.getElementById('loading-spinner');
            const noSummaries = document.getElementById('no-summaries');

            // --- æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘ ---
            function showViewSection() {
                sectionView.classList.remove('hidden');
                sectionSubmit.classList.add('hidden');
                tabView.classList.add('active', 'text-white');
                tabSubmit.classList.remove('active', 'text-white');
                tabSubmit.classList.add('text-gray-400');
                // åˆ‡æ¢æ—¶é‡æ–°åŠ è½½æ€»ç»“
                loadSummaries();
            }
            
            function showSubmitSection() {
                sectionView.classList.add('hidden');
                sectionSubmit.classList.remove('hidden');
                tabView.classList.remove('active', 'text-white');
                tabView.classList.add('text-gray-400');
                tabSubmit.classList.add('active', 'text-white');
            }

            tabView.addEventListener('click', showViewSection);
            tabSubmit.addEventListener('click', showSubmitSection);

            // --- åŠ è½½æ€»ç»“é€»è¾‘ ---
            async function loadSummaries() {
                loadingSpinner.classList.remove('hidden');
                summaryGrid.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
                noSummaries.classList.add('hidden');

                // --- æœ¬åœ°é¢„è§ˆæ¨¡æ‹Ÿ ---
                // æ£€æŸ¥æ˜¯å¦åœ¨æœ¬åœ°é¢„è§ˆç¯å¢ƒ (å¦‚ blob: URL æˆ– file: URL)
                if (window.location.protocol.startsWith('blob') || window.location.protocol === 'file:') {
                    console.log("æœ¬åœ°é¢„è§ˆæ¨¡å¼ï¼šæ­£åœ¨åŠ è½½æ¨¡æ‹Ÿæ•°æ®...");
                    
                    // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    const mockSummaries = [
                        { 
                            date: new Date().toISOString(), 
                            summary: "ã€æ¨¡æ‹Ÿæ•°æ®ã€‘ä»Šå¤©å­¦ä¹ äº† N2 è¯­æ³•ã€Œï½ã‚‚ã®ã ã‹ã‚‰ã€ï¼Œæ„Ÿè§‰å¾ˆæœ‰è¶£ã€‚", 
                            gemini_response: "ç´ æ™´ã‚‰ã—ã„ï¼ãã®èª¿å­ã§é ‘å¼µã£ã¦ï¼" 
                        },
                        { 
                            date: new Date(Date.now() - 86400000).toISOString(), // 1 day ago
                            summary: "ã€æ¨¡æ‹Ÿæ•°æ®ã€‘å¤ä¹ äº† N3 çš„åŠ¨è¯å˜å½¢ï¼Œç‰¹åˆ«æ˜¯ã€Œä½¿å½¹å½¢ã€å’Œã€Œå—èº«å½¢ã€ã€‚", 
                            gemini_response: "åŸºæœ¬ã¯å¤§äº‹ã§ã™ã­ã€‚ã‚ˆãã§ãã¾ã—ãŸï¼"
                        }
                    ];

                    if (mockSummaries.length === 0) {
                        noSummaries.classList.remove('hidden');
                    } else {
                        mockSummaries.forEach(item => {
                            const card = document.createElement('div');
                            card.className = 'summary-card glass-card rounded-xl p-6 shadow-lg';
                            const formattedDate = new Date(item.date).toLocaleString('zh-CN', { 
                                year: 'numeric', month: 'long', day: 'numeric',
                                hour: 'numeric', minute: 'numeric'
                            });
                            card.innerHTML = `
                                <p class="text-sm text-gray-400 mb-2">${formattedDate}</p>
                                <p class="text-gray-100 whitespace-pre-line">${item.summary}</p>
                                ${item.gemini_response ? `<p class="mt-4 text-sm text-purple-300 border-l-2 border-purple-400 pl-3">ğŸ¤– è€å¸ˆç‚¹è¯„ï¼š${item.gemini_response}</p>` : ''}
                            `;
                            summaryGrid.appendChild(card);
                        });
                    }
                    loadingSpinner.classList.add('hidden');
                    return; // ç»“æŸå‡½æ•°ï¼Œä¸æ‰§è¡Œä¸‹é¢çš„çœŸå® fetch
                }
                
                // --- çœŸå®çš„ Netlify Fetch (éƒ¨ç½²åä¼šè¿è¡Œè¿™é‡Œ) ---
                try {
                    // è¿™æ˜¯ Netlify å‡½æ•°çš„ "ç¥å¥‡" è·¯å¾„
                    const response = await fetch('/.netlify/functions/getSummaries');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const summaries = await response.json();
                    
                    if (summaries.length === 0) {
                        noSummaries.classList.remove('hidden');
                    } else {
                        // æŒ‰æ—¥æœŸå€’åºæ˜¾ç¤º
                        summaries.sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        summaries.forEach(item => {
                            const card = document.createElement('div');
                            card.className = 'summary-card glass-card rounded-xl p-6 shadow-lg';
                            
                            const formattedDate = new Date(item.date).toLocaleString('zh-CN', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric',
                                hour: 'numeric',
                                minute: 'numeric'
                            });
                            
                            card.innerHTML = `
                                <p class="text-sm text-gray-400 mb-2">${formattedDate}</p>
                                <p class="text-gray-100 whitespace-pre-line">${item.summary}</p>
                                ${item.gemini_response ? `<p class="mt-4 text-sm text-purple-300 border-l-2 border-purple-400 pl-3">ğŸ¤– è€å¸ˆç‚¹è¯„ï¼š${item.gemini_response}</p>` : ''}
                            `;
                            summaryGrid.appendChild(card);
                        });
                    }
                } catch (error) {
                    console.error('åŠ è½½æ€»ç»“å¤±è´¥:', error);
                    noSummaries.textContent = 'âŒ åŠ è½½æ—¥è®°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚';
                    noSummaries.classList.remove('hidden');
                } finally {
                    loadingSpinner.classList.add('hidden');
                }
            }

            // --- è¡¨å•æäº¤é€»è¾‘ ---
            summaryForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤
                
                const password = passwordInput.value;
                const summary = contentInput.value;
                
                // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½ä¸­
                submitButton.disabled = true;
                submitButton.innerHTML = `<span class="loader" style="width:24px; height:24px; border-width: 2px;"></span>`;
                formMessage.textContent = '';
                formMessage.className = 'mt-4 text-center';

                // --- æœ¬åœ°é¢„è§ˆæ¨¡æ‹Ÿ ---
                if (window.location.protocol.startsWith('blob') || window.location.protocol === 'file:') {
                    console.log("æœ¬åœ°é¢„è§ˆæ¨¡å¼ï¼šæ­£åœ¨æ¨¡æ‹Ÿæäº¤...");
                    await new Promise(resolve => setTimeout(resolve, 1500)); // æ¨¡æ‹Ÿæäº¤å»¶è¿Ÿ
                    
                    // æ¨¡æ‹ŸæˆåŠŸ
                    formMessage.textContent = 'ğŸ‰ ã€æ¨¡æ‹Ÿã€‘æäº¤æˆåŠŸï¼';
                    formMessage.classList.add('text-green-400');
                    contentInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                    
                    // 2ç§’åè‡ªåŠ¨åˆ‡æ¢å›æŸ¥çœ‹é¡µé¢
                    setTimeout(() => {
                        showViewSection();
                        formMessage.textContent = '';
                    }, 2000);

                    // æ¢å¤æŒ‰é’®
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>æäº¤æ€»ç»“</span>';
                    return; // ç»“æŸå‡½æ•°ï¼Œä¸æ‰§è¡ŒçœŸå® fetch
                }

                // --- çœŸå®çš„ Netlify Fetch (éƒ¨ç½²åä¼šè¿è¡Œè¿™é‡Œ) ---
                try {
                    // è°ƒç”¨ "submitSummary" åç«¯å‡½æ•°
                    const response = await fetch('/.netlify/functions/submitSummary', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password, summary })
                    });
                    
                    const result = await response.json();

                    if (!response.ok) {
                        // å¤„ç†åç«¯è¿”å›çš„é”™è¯¯ï¼ˆå¦‚å¯†ç é”™è¯¯ï¼‰
                        throw new Error(result.error || 'æäº¤å¤±è´¥');
                    }
                    
                    // æˆåŠŸ!
                    formMessage.textContent = 'ğŸ‰ æäº¤æˆåŠŸï¼å·²ç”Ÿæˆ AI ç‚¹è¯„ã€‚';
                    formMessage.classList.add('text-green-400');
                    contentInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                    
                    // 2ç§’åè‡ªåŠ¨åˆ‡æ¢å›æŸ¥çœ‹é¡µé¢
                    setTimeout(() => {
                        showViewSection();
                        formMessage.textContent = '';
                    }, 2000);

                } catch (error) {
                    console.error('æäº¤å¤±è´¥:', error);
                    formMessage.textContent = `âŒ å¤±è´¥: ${error.message}`;
                    formMessage.classList.add('text-red-400');
                } finally {
                    // æ¢å¤æŒ‰é’®
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span>æäº¤æ€»ç»“</span>';
                }
            });

            // --- åˆå§‹åŠ è½½ ---
            loadSummaries();
        });
    </script>
</body>
</html>